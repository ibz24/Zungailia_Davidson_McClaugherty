---
title: "Data_Analysis"
author: "Isabel Zungailia"
date: "2022-11-29"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
#Check working directory
getwd()

#Load necessary packages
library(dplyr)
library(lubridate)
library(tidyverse)
library(cowplot)
install.packages("ggplot2")
library(ggplot2)
install.packages("ggpubr")
library(ggpubr)
library(Kendall)

#Set theme

```

```{r}
#Reading in csv files for each site:
site1 <- read.csv("./Data/Processed/coweeta_site1.csv")
site2 <- read.csv("./Data/Processed/coweeta_site2.csv")
site3 <- read.csv("./Data/Processed/coweeta_site3.csv")
site4 <- read.csv("./Data/Processed/coweeta_site4.csv")

Coweeta_wrangled3 <- read.csv("./Data/Processed/Coweeta_wrangled3.csv")
```

```{r}
#Formatting Dates
site1$Date <- as.Date(site1$Date, format = '%Y-%m-%d')
site2$Date <- as.Date(site2$Date, format = '%Y-%m-%d')
site3$Date <- as.Date(site3$Date, format = '%Y-%m-%d')
site4$Date <- as.Date(site4$Date, format = '%Y-%m-%d')

Coweeta_wrangled3$Date <- as.Date(Coweeta_wrangled3$Date, format = '%Y-%m-%d')
```

```{r}
#averaging by date for each site

site1_averaged <-site1 %>% 
  group_by(Date) %>% 
  summarise(AverageDailySmois30 = mean(smois30))

site2_averaged <- site2 %>% 
  group_by(Date) %>% 
  summarise(AverageDailySmois30 = mean(smois30))

site3_averaged <- site3 %>% 
  group_by(Date) %>% 
    summarise(AverageDailySmois30 = mean(smois30))

site4_averaged <- site4 %>% 
  group_by(Date) %>% 
    summarise(AverageDailySmois30 = mean(smois30))
```


```{r}
#Notes on time series

#Time series datasets come with several caveats, which need to be addressed in order to effectively model the system. A few common challenges that arise (and can occur together within a single dataset) are: 

#Autocorrelation: Data points are not independent from one another (i.e., the measurement at a given time point is dependent on previous time point(s)) - still only looking at one variable, just at different points in time

#Data gaps: Data are not collected at regular intervals, necessitating *interpolation* between measurements.

#Seasonality: seasonal patterns in variables occur at regular intervals, impeding clear interpretation of a monotonic (unidirectional) trend. relatively SHORT intervals (ex: dry vs wet seasons)

#Heteroscedasticity: The variance of the time series is not constant over time

#Covariance: the covariance of the time series is not constant over time

#creating a ts for each site
site1_ts <- ts(site1_averaged$AverageDailySmois30, start = c(2000, 1), frequency = 365)

site2_ts <- ts(site2_averaged$AverageDailySmois30, start = c(2000,1), frequency = 365)

site3_ts <- ts(site3_averaged$AverageDailySmois30, start = c(2000,1), frequency = 365)

site4_ts <- ts(site4_averaged$AverageDailySmois30, start = c(2000,1), frequency = 365)

#decomposing the ts

site1_decomposed <- stl(site1_ts, s.window = "periodic")

site2_decomposed <- stl(site2_ts, s.window = "periodic")

site3_decomposed <- stl(site3_ts, s.window = "periodic")

site4_decomposed <- stl(site4_ts, s.window = "periodic")

#plotting decomposed ts
#trend component seems to explain much of the variability in sites 3 & 4
#seasonality component seems to explain more of the variability in sites 1 & 2

plot(site1_decomposed) 
plot(site2_decomposed)
plot(site3_decomposed)
plot(site4_decomposed)

#Notes on Components

#Seasonal component: repeats over a fixed known period (e.g., seasons of the year, months, days of the week, hour of the day)

#Trend component: quantifies the upward or downward progression over time. The trend component of a time series does not have to be monotonic.

```

```{r}
#Monotonic trend analysis notes (will either be upward or downward)

#Linear regression: no seasonality, fits the assumptions of a parametric test. Function: `lm`

#Mann-Kendall: no seasonality, non-parametric, missing data allowed. Function: `MannKendall()` (package: Kendall)

#Seasonal Mann-Kendall: seasonality, non-parametric `SeasonalMannKendall` (package: Kendall)

#running trend analysis


site1_trend <- Kendall::SeasonalMannKendall(site1_ts)
summary(site1_trend)

site2_trend <- Kendall::SeasonalMannKendall(site2_ts)
summary(site2_trend)

site3_trend <- Kendall::SeasonalMannKendall(site3_ts)
summary(site3_trend)

site4_trend <- Kendall::SeasonalMannKendall(site4_ts)
summary(site4_trend)
```

```{r}
#One-way ANOVA test - used when you have one categorical explanatory variable with more than two categories
  #Question: Does the mean smois30 value differ among sites at the Coweeta Basin LTER?

#Wrangle data to group by size and calcualte the mean smois30 value for each site. Also calcualte standard deviation.
Coweeta_Mean_Smois30 <- Coweeta_wrangled3 %>% 
  group_by(site) %>% 
  summarise(MeanSmois30 = mean(smois30),
            StdDevSmois30 = sd(smois30))

summary(Coweeta_Mean_Smois30)

#Boxplot to explore distribution of smois30 values at each site
boxplot(MeanSmois30 ~ site,
        data = Coweeta_Mean_Smois30,
        xlab = "Site",
        ylab = "Mean Soil Moisture")

#ANOVA test (response variable ~ predictor variable)
Coweeta_Mean_Smois30_ANOVA <- aov(data = Coweeta_Mean_Smois30, MeanSmois30 ~ site)
summary(Coweeta_Mean_Smois30_ANOVA)

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
